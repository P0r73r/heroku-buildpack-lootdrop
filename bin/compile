#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

# Configure environment
set -e            # fail fast
set -o pipefail   # don't ignore exit codes when piping output
set -x            # enable debugging

BUILD_DIR=${1:-}

export PATH="$BUILD_DIR/.heroku/node/bin":$PATH

BP_DIR=$(cd $(dirname ${0:-}); cd ..; pwd)
source $BP_DIR/lib/binaries.sh

pushd $BUILD_DIR/src/main/resources/static/cashrecon/

touch package-lock.json
rm package-lock.json
node -v
npm install --only=production
npm run build

popd
